<!doctype html>
<html lang="en">
    {include file="/head" /}
    {include file="/nav" /}
    <!-- END Sidebar -->
        <style>
        .a{
            margin-top: 20px;
        }
        .badge {
            cursor: pointer;
        }
        .search{
            display: flex;
            height: 50px;
            width: 200px;
            /*float: right;*/
            justify-content: space-between;
        }
        .search input{
            height: 60%;
            width: 72%;
        }
        .cont{
            display: flex;
            height: 50px;
            width: 220px;
            float: left;
        }
        td{
            
            font-size: 16px;
        }
        .btn-group{
            height: 35px;
        }
        .hebox{
            display: flex;
            justify-content: space-between;
        }
        </style>
            <div class="main-content">

                <div class="page-content">

                    <!-- Page-Title -->
                    <div class="page-title-box">
                        <div class="container-fluid">
                            <div class="row align-items-center">
                                <div class="col-md-8">
                                    <h4 class="page-title mb-1">用户列表</h4>
                                    <ol class="breadcrumb m-0">
                                        <li class="breadcrumb-item"><a href="javascript: void(0);">用户管理</a></li>
                                    <li class="breadcrumb-item active">用户列表</li>
                                    </ol>
                                </div>
                                
                            </div>

                        </div>
                    </div>
                    <!-- end page title end breadcrumb -->
    
                    <div class="page-content-wrapper">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col-12">
                                    <div class="card">
                                        <div class="card-body">
            
                                            <h4 class="header-title">用户列表</h4>
                                            <p class="card-title-desc">如有重复资源在库内,替换会使用最后一次提交的数据<code>请详知</code>.
                                           
                                            </p>
                                            <div class="hebox">
                                            <div class="cont">
                                                <div class="btn-group" role="group" style="width:45%">
                                                <button id="btnGroupDrop1" type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                选中方式 <i class="mdi mdi-chevron-down ml-1"></i>
                                                              </button>
                                                              <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                                                                  <a class="dropdown-item" id="all">全选</a>
                                                                  <a class="dropdown-item" id="alldie">取消全选</a>
                                                              </div>
                                                </div>
                                                
                                                
                                            <div class="btn-group" role="group" style="width:45%">
                                                              <button id="btnGroupDrop1" type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                选中操作 <i class="mdi mdi-chevron-down ml-1"></i>
                                                              </button>
                                                              <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                                                                  <a class="dropdown-item" id="qiyong">启用</a>
                                                                <a class="dropdown-item" id="jinyong">禁用</a>
                                                                <a class="dropdown-item" id="delete">删除</a>
                                                              </div>
                                                            </div>
                                                
                                            </div>
                                            <div class="search">
                                                <input name="search" placeholder="用户名/邮箱/UID">
                                                <input type="submit" class="btn btn-primary btn-sm" style="width:25%" value="搜索" id="search">
                                            </div>
                                            </div>
                                            <table id="datatable" class="table table-bordered dt-responsive nowrap" style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                                <thead>
                                                <tr>
                                                    <th>id</th>
                                                    <th>用户名</th>
                                                    <th>UID</th>
                                                    <th>邮箱</th>
                                                    <th>余额</th>
                                                    <th>注册时间</th>
                                                    <th>状态</th>
                                                    <th>操作</th>
                                                </tr>
                                                </thead>

                                                <tbody>
                                                {volist name="list" id="data"}
                                                <tr>
                                                    <!--<td><span class="badge badge-primary">{$data.id}</span></td>-->
                                                    <td><input name="id" type="checkbox" value="{$data.id}" style="width: 20px;height: 20px;"></td>
                                                    <td>{$data.username}</td>
                                                    <td>{$data.uid}</td>
                                                    <td>{$data.email}</td>
                                                    <td>{$data.balance}</td>
                                                    <td><span class="badge badge-soft-primary">{$data.intime|date="Y-m-d H:i:s"}</span></td>
                                                    <td>{eq name="$data.status" value="1"}<span onclick="disable('{$data.id}','u')" class="badge badge-success">
                                                        正常
                                                    </span>{/eq}{eq name="$data.status" value="0"}<span onclick="disable('{$data.id}','y')" class="badge badge-danger">禁用</span>{/eq}</td>
                                                    <!--<td><a href="{:url('increase')}?user={$data.username}">加款</a> <a href="">删除</a></td>-->
                                                    <td>
                                                        <div class="btn-group" role="group">
                                                              <button id="btnGroupDrop1" type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                操作 <i class="mdi mdi-chevron-down ml-1"></i>
                                                              </button>
                                                              <div class="dropdown-menu" aria-labelledby="btnGroupDrop1">
                                                                <a class="dropdown-item" href="{:url('increase')}?user={$data.username}">加款</a>
                                                                <a class="dropdown-item" href="{:url('edit')}?user={$data.username}">编辑</a>
                                                                <a class="dropdown-item" href="{:url('del')}?user={$data.username}">删除</a>
                                                              </div>
                                                            </div>
                                                    </td>
                                                </tr>
                                                {/volist}
                                                </tbody>
                                                
                                            </table>
                                            {$list|raw}
                                        </div>
                                        
                                    </div>
                                </div> <!-- end col -->
                            </div> <!-- end row -->
            
                         

                        </div>
                        <!-- end container-fluid -->
                    </div> 
                    <!-- end page-content-wrapper -->
                </div>
                <!-- End Page-content -->

                
        {include file="/footer"}
        <!-- /Right-bar -->

        <!-- Right bar overlay-->
        <div class="rightbar-overlay"></div>

        <!-- JAVASCRIPT -->
        <script src="/static/adassets/libs/jquery/jquery.min.js"></script>
        <script src="/static/adassets/libs/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="/static/adassets/libs/metismenu/metisMenu.min.js"></script>
        <script src="/static/adassets/libs/simplebar/simplebar.min.js"></script>
        <script src="/static/adassets/libs/node-waves/waves.min.js"></script>

        <script src="/static/adassets/js/bundle.js"></script>

        <!-- datepicker -->
        <script src="/static/adassets/libs/air-datepicker/js/datepicker.min.js"></script>
        <script src="/static/adassets/libs/air-datepicker/js/i18n/datepicker.en.js"></script>

        <!-- apexcharts -->
        <script src="/static/adassets/libs/apexcharts/apexcharts.min.js"></script>

        <script src="/static/adassets/libs/jquery-knob/jquery.knob.min.js"></script> 

        <!-- Jq vector map -->
        <script src="/static/adassets/libs/jqvmap/jquery.vmap.min.js"></script>
        <script src="/static/adassets/libs/jqvmap/maps/jquery.vmap.usa.js"></script>

        <script src="/static/adassets/js/pages/dashboard.init.js"></script>

        <script src="/static/adassets/js/app.js"></script>
        <script>
            arr = [];
            $(document).on('click','input[name="id"]',function(){
                var sta = $(this).is(":checked");
                if(sta){
                    var key = $(this).val();
                    arr[key] = key;
                }else{
                    var key = $(this).val();
                    delete(arr[key]);
                }
                console.log(arr);
            });
            $("#all").click(function(){
                var num = $("tbody tr").length;
                for(var i=0;i<=num-1;i++){
                    $('input[name="id"]').prop("checked", "true");
                    var key = $('input[name="id"]').eq(i).val();
                    arr[key] = key;
                }
                console.log(arr);
            });
            $("#alldie").click(function(){
                 arr = [];
                 var num = $("tbody tr").length;
                 for(var i=0;i<=num-1;i++){
                    $('input[name="id"]').prop("checked", "");
                    var key = $('input[name="id"]').eq(i).val();
                    arr[key] = key;
                }
            });
            $('#delete').click(function(){
                 pl(arr,'delete');
            });
            $('#jinyong').click(function(){
                 pl(arr,'jinyong');
            });
            $('#qiyong').click(function(){
                 pl(arr,'qiyong');
            });
            
            $('#search').click(function(){
                 var value = $("input[name='search']").val();
                 $.ajax({
                    url:'/admin/UserManage/search',
                    type:'post',
                    data:{
                      value,
                    },
                    success:function(data){
                        if(data.code==200){
                            if(data.data.status == 0){
                                sta = `<span class="badge badge-danger" onclick="disable(${data.data.id},'y')">禁用</span>`;
                            }else{
                                sta = `<span class="badge badge-success" onclick="disable(${data.data.id},'u')">正常</span>`;
                            }
                            str = '<tr><td><input name="id" type="checkbox" value="'+data.data.id+'" style="width: 20px;height: 20px;"></td><td>'+data.data.username+'</td><td>'+data.data.user_uid+'</td><td>'+data.data.email+'</td><td>'+data.data.balance+'</td><td><span class="badge badge-soft-primary">'+data.data.intime+'</span></td><td>'+sta+'</td><td><div class="btn-group" role="group"><button id="btnGroupDrop1" type="button" class="btn btn-secondary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">操作 <i class="mdi mdi-chevron-down ml-1"></i></button><div class="dropdown-menu" aria-labelledby="btnGroupDrop1"><a class="dropdown-item" href="/admin/UserManage/increase.html?user='+data.data.username+'">加款</a><a class="dropdown-item" href="./edit?user='+data.data.username+'">编辑</a><a class="dropdown-item" href="">删除</a></div></div></td></tr>';
                            $('tbody').html(str);
                            $('.pagination').hide();
                        }else{
                            alert(data.msg);
                            window.location.reload()
                        }
                    }
                });
            });
            function pl(arr,fs){

                $.ajax({
                    url:'/admin/UserManage/pl',
                    type:'post',
                    data:{
                      arr,
                      fs,
                    },
                    success:function(){
                        window.location.reload()
                    }
                });
            }

            function disable(id,e){
                if(e=='u'){
                    var isbeauty=confirm("确定禁用吗？");
                    if (isbeauty){
                        up(id,e);
                    }
                }else{
                    var isbeauty=confirm("确定启用吗？");
                    if (isbeauty){
                        up(id,e);
                    }
                }
            }
            
            function up(id,e){
                $.ajax({
                    url:'/admin/UserManage/upstatus',
                    type:'post',
                    data:{
                        id,
                        e,
                    },
                    success:function(data){
                        window.location.reload()
                    }
                });
            }
            $(document).ready(function(){
               $("ul.pagination li").addClass("page-item");
                $("ul.pagination li a").addClass("page-link");
                var page = $("ul.pagination li.active span").text();
                $("ul.pagination li.active").html('<a class="page-link" href="#">'+page+'<span class="sr-only">(current)</span></a>');
                $("ul.pagination li span").addClass("page-link");
            });
            
        </script>

    </body>
</html>